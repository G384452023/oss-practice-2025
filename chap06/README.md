# 第6回：Gitブランチ実習（探求編）

## この回で学ぶこと

この回では，Gitの「ブランチ」機能について学びます．
ブランチを使うことで，複数の作業を並行して進めたり，メインの作業に影響を与えずに新しい機能を試したりできるようになります．

## 事前に考えてみよう 🤔

これから，main ブランチから「新機能用」と「バグ修正用」の2つのブランチを作成し，それぞれでコミットを行う実習をします．

**質問：** この作業が終わった後，`git log` で履歴を表示したら，コミットは一本の直線に見えると思いますか？ それとも別の形に見えると思いますか？

答えは実習の最後に確認しましょう！

## ブランチとは？

ブランチとは，日本語で「枝」という意味です．
まるで木の幹から枝が分かれるように，メインの開発ラインから別の作業ラインを分岐させることができます．

### ブランチを使う理由

- **安全に新機能を開発できる**：メインの作業に影響を与えずに，新しい機能を試せる
- **複数の作業を並行できる**：バグ修正と新機能開発を同時に進められる
- **元に戻しやすい**：うまくいかなかったら，その枝を捨てればいい

## 実習の準備

### リポジトリの確認

まず，このリポジトリのchap06ディレクトリにいることを確認しましょう．

```bash
cd /path/to/oss-practice-2025/chap06
```

現在のブランチを確認：

```bash
git branch
```

現在地を確認：

```bash
pwd
```

## 実習1：並行作業シミュレーション（分岐の作成）

### ステップ1-A：新機能用ブランチでの作業

まず，新機能を追加するためのブランチを作成します．

#### 1. ブランチを作成する

```bash
git branch feature/add-profile
```

このコマンドで `feature/add-profile` という名前のブランチが作成されます．
まだ移動はしていません．

#### 2. 作成したブランチに移動する

```bash
git switch feature/add-profile
```

**ポイント**：`git switch` は，ブランチを切り替えるコマンドです．

#### 3. 今いるブランチを確認

```bash
git branch
```

`feature/add-profile` の前に `*` マークがついていれば，そのブランチにいることがわかります．

#### 4. 新しいファイルを作成

`profile.txt` というファイルを作成し，自己紹介を書きましょう．

```bash
echo "名前：山田太郎" > profile.txt
echo "学年：1年" >> profile.txt
echo "趣味：プログラミング" >> profile.txt
```

または，お好きなテキストエディタで作成してもOKです：

```bash
nano profile.txt
# または
code profile.txt  # VS Codeの場合
```

#### 5. ファイルの中身を確認

```bash
cat profile.txt
```

#### 6. 変更をステージング＆コミット

```bash
git add profile.txt
git commit -m "feat: Add profile"
```

**ポイント**：コミットメッセージの `feat:` は，「新機能（feature）を追加した」という意味の接頭辞です．

---

### ステップ1-B：バグ修正用ブランチでの作業

次に，別のブランチでバグ修正を行います．
ここが重要なポイントです！

#### 1. main ブランチに戻る

```bash
git switch main
```

#### 2. profile.txt が消えたことを確認

```bash
ls
```

あれ？さっき作った `profile.txt` がありませんね？
これは，`feature/add-profile` ブランチにいたときだけ存在するファイルだからです．
**ブランチごとに，ファイルの状態が隔離されています．**

#### 3. 新しいブランチを作成

main ブランチから，今度はバグ修正用のブランチを作成します．

```bash
git branch bugfix/fix-readme
```

#### 4. バグ修正ブランチに移動

```bash
git switch bugfix/fix-readme
```

#### 5. README.md を編集

このディレクトリには README.md（この資料）があります．
何か小さな変更を加えてみましょう（例：タイトルに絵文字を追加，説明を追加など）．

```bash
# ファイルの最後に何か追加
echo "" >> README.md
echo "## 補足" >> README.md
echo "この資料は2025年度の講義で使用しています．" >> README.md
```

または，エディタで直接編集してもOKです：

```bash
nano README.md
```

#### 6. 変更をステージング＆コミット

```bash
git add README.md
git commit -m "fix: Fix typo in README"
```

**ポイント**：コミットメッセージの `fix:` は，「バグ修正」という意味の接頭辞です．

---

## 実習2：分岐の「可視化」

さて，ここまでで2つの異なるブランチで作業を行いました．
では，この履歴がどうなっているのか見てみましょう！

### ステップ2-A：git log でブランチの分岐を確認

#### すべてのブランチの履歴を表示

```bash
git log --oneline --graph --all
```

**オプションの意味**：

- `--oneline`：1行で簡潔に表示
- `--graph`：分岐をアスキーアートで表示
- `--all`：すべてのブランチを表示

#### 出力例

```
* 1a2b3c4 (bugfix/fix-readme) fix: Fix typo in README
| * 4d5e6f7 (feature/add-profile) feat: Add profile
|/
* 9f2cabc (HEAD -> main) Initial commit
```

**見方**：

- `*` がコミットを表しています
- `|` や `/` が分岐を表しています
- main のコミットから，歴史が2つに分かれているのが見えます！

**冒頭の質問の答え**：コミットは一本の直線ではなく，**分岐した形**に見えます！

---

### ステップ2-B：ブランチ間の「差分」を確認

#### main と feature ブランチの差分

```bash
git diff main feature/add-profile
```

これで，main ブランチと feature/add-profile ブランチの間で何が違うかが表示されます．
`+profile.txt` が表示され，profile.txt が追加されていることがわかります．

#### main と bugfix ブランチの差分

```bash
git diff main bugfix/fix-readme
```

README.md の変更内容が表示されます．

---

## 実習3：探求：ブランチ（ポインタ）の「実体」

最後に，ブランチの「正体」を探求してみましょう．
実は，ブランチはとてもシンプルな仕組みで動いています．

### ステップ3-A：`.git/refs/heads` を覗く

#### ブランチファイルの一覧を表示

```bash
ls .git/refs/heads
```

または，ディレクトリ構造も含めて表示：

```bash
ls -R .git/refs/heads
```

**出力例**：

```
main
feature
bugfix
```

または：

```
main
feature/
  add-profile
bugfix/
  fix-readme
```

見てください！私たちが作ったブランチ名のファイルやディレクトリがありますね．

---

### ステップ3-B：ポインタの中身を見る

#### main ブランチの中身を確認

```bash
cat .git/refs/heads/main
```

**出力例**：

```
9f2cabc1234567890abcdef1234567890abcdef
```

これは**コミットID**（コミットハッシュ）です！

#### bugfix ブランチの中身を確認

```bash
cat .git/refs/heads/bugfix/fix-readme
```

**出力例**：

```
1a2b3c4567890abcdef1234567890abcdef1234
```

これも**コミットID**です！

#### feature ブランチの中身も確認

```bash
cat .git/refs/heads/feature/add-profile
```

**出力例**：

```
4d5e6f7890abcdef1234567890abcdef12345678
```

これも**コミットID**です！

---

### ブランチの正体

つまり，**ブランチの正体とは，単にコミットIDが書かれたテキストファイル**だったのです！

- ブランチは「軽量なポインタ」と呼ばれます
- 実際には，特定のコミットを指し示す小さなテキストファイルに過ぎません
- だからこそ，ブランチの作成や切り替えが非常に高速にできるのです

---

## まとめ

### この回で学んだコマンド

- **`git branch ブランチ名`**：新しいブランチを作成
- **`git switch ブランチ名`**：ブランチを切り替え
- **`git branch`**：ブランチの一覧を表示（`*` が現在のブランチ）
- **`git log --oneline --graph --all`**：ブランチの分岐を可視化
- **`git diff ブランチ1 ブランチ2`**：ブランチ間の差分を表示

### ブランチの仕組み

1. ブランチは，コミットを指すポインタ
2. 実体は `.git/refs/heads` にあるテキストファイル
3. ブランチを切り替えると，作業ディレクトリのファイルも変わる
4. 複数のブランチで並行作業ができる

---

## 課題：ブランチの探求と可視化

### 課題内容

あなたの学籍番号を使って，ブランチを作成し，可視化してみましょう．

#### ステップ1：main ブランチに戻る

```bash
git switch main
```

#### ステップ2：自分の学籍番号でブランチを作成

```bash
git branch add-profile-[あなたの学籍番号]
```

例：学籍番号が `123456` の場合

```bash
git branch add-profile-123456
```

#### ステップ3：作成したブランチに移動

```bash
git switch add-profile-[あなたの学籍番号]
```

#### ステップ4：自己紹介ファイルを作成

`my-profile.txt` というファイルを作成し，自己紹介を書きましょう．

```bash
nano my-profile.txt
# または
code my-profile.txt
```

内容例：

```
名前：[あなたの名前]
学籍番号：[あなたの学籍番号]
学年：1年
学科：[あなたの学科]
趣味：[あなたの趣味]
好きなプログラミング言語：[あなたの回答]
```

#### ステップ5：変更をコミット

```bash
git add my-profile.txt
git commit -m "feat: Add my profile"
```

#### ステップ6：ブランチの可視化

```bash
git log --oneline --graph --all
```

#### ステップ7：ブランチの実体を確認

```bash
cat .git/refs/heads/add-profile-[あなたの学籍番号]
```

#### ステップ8：スクリーンショットを撮影

以下の2つのコマンドの実行結果をスクリーンショットで撮影してください：

1. `git log --oneline --graph --all` の結果
2. `cat .git/refs/heads/add-profile-[あなたの学籍番号]` の結果

---

### 提出物

以下を提出してください：

1. **スクリーンショット1**：`git log --oneline --graph --all` の実行結果
2. **スクリーンショット2**：`cat .git/refs/heads/add-profile-[あなたの学籍番号]` の実行結果
3. **感想**（任意）：ブランチの仕組みについて学んだことや，疑問に思ったことを自由に書いてください（200字程度）

---

## 発展：もっと学びたい人へ

### ブランチの削除

使わなくなったブランチは削除できます：

```bash
git branch -d ブランチ名
```

### ブランチの作成と移動を同時に行う

`git switch` に `-c` オプションをつけると，ブランチの作成と移動を一度にできます：

```bash
git switch -c 新しいブランチ名
```

### すべてのブランチを見る

```bash
git branch -a
```

これで，ローカルだけでなく，リモートのブランチも表示されます．

---

## 参考資料

- [Git公式ドキュメント - ブランチとは](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD-%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%A8%E3%81%AF)
- [Gitブランチの図解](https://learngitbranching.js.org/?locale=ja)

---

お疲れさまでした！ブランチの基本を理解できましたか？
次回は，ブランチを統合する「マージ」について学びます．
